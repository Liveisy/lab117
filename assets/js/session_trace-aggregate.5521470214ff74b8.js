"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2189],{28500:(e,t,s)=>{s.r(t),s.d(t,{Aggregate:()=>b});var i=s(80326),r=s(51368),n=s(98916),a=s(8068),o=s(26196),h=s(40775),c=s(78367),u=s(61410);class m{constructor(e,t,s,i,r){this.n=e,this.s=t,this.e=s,this.o=i,this.t=r}}let l="function"==typeof a.gm.PerformanceObserver,d={global:{mouseup:!0,mousedown:!0,mousemove:!0},window:{load:!0,pagehide:!0},xhrOriginMissing:{ignoreAll:!0}},g={typing:[1e3,2e3],scrolling:[100,1e3],mousing:[1e3,2e3],touching:[1e3,2e3]};class p{nodeCount=0;trace={};earliestTimeStamp=1/0;latestTimeStamp=0;prevStoredEvents=new Set;#e;constructor(e){this.parent=e}#t(){return!this.parent.blocked&&(!(this.nodeCount>=r.jx)||this.parent.mode===o.g.ERROR&&0!==this.trimSTNs(3e4))}#s(e){this.trace[e.n]?this.trace[e.n].push(e):this.trace[e.n]=[e],e.s<this.earliestTimeStamp&&(this.earliestTimeStamp=e.s),e.s>this.latestTimeStamp&&(this.latestTimeStamp=e.s),this.nodeCount++}trimSTNs(e){let t=0,s=Math.max((0,h.t)()-e,0);return Object.keys(this.trace).forEach(e=>{let i=this.trace[e],r=i.findIndex(e=>s<=e.e);0!==r&&(r<0?(r=i.length,delete this.trace[e]):i.splice(0,r),this.nodeCount-=r,t+=r)}),t}takeSTNs(){l||this.storeResources(a.gm.performance?.getEntriesByType?.("resource"));let e=Object.entries(this.trace).flatMap(([e,t])=>{if(!(e in g))return t;let s=this.smearEvtsByOrigin(e);return Object.values(t.sort((e,t)=>e.s-t.s).reduce(s,{})).flat()},this);return{stns:e,earliestTimeStamp:this.earliestTimeStamp,latestTimeStamp:this.latestTimeStamp}}smearEvtsByOrigin(e){let t=g[e][0],s=g[e][1],i={};return(r,n)=>{var a;let o=r[n.o];o||(o=r[n.o]=[]);let h=i[n.o];return"scrolling"!==e||(a=n)&&"number"==typeof a.e&&"number"==typeof a.s&&a.e-a.s<4?h&&n.s-h.s<s&&h.e>n.s-t?h.e=n.e:(i[n.o]=n,o.push(n)):(i[n.o]=null,n.n="scroll",o.push(n)),r}}storeNode(e){this.#t()&&this.#s(e)}processPVT(e,t,s){this.storeTiming({[e]:t})}storeTiming(e,t=!1){if(e)for(let s in e){let i=e[s],r=s.toLowerCase();if(!(r.indexOf("size")>=0||r.indexOf("status")>=0)&&"number"==typeof i&&i>=0){if(i=Math.round(i),this.parent.timeKeeper&&this.parent.timeKeeper.ready&&t&&(i=this.parent.timeKeeper.convertAbsoluteTimestamp(Math.floor(this.parent.timeKeeper.correctAbsoluteTimestamp(i)))),!this.#t())return;this.#s(new m(s,i,i,"document","timing"))}}}storeEvent(e,t,s,i){if(this.shouldIgnoreEvent(e,t)||!this.#t()||this.prevStoredEvents.has(e))return;this.prevStoredEvents.add(e);let r=new m(this.evtName(e.type),s,i,void 0,"event");try{r.o=(0,u.t)(e.target,t,this.parent.ee)}catch(e){r.o=(0,u.t)(null,t,this.parent.ee)}this.#s(r)}shouldIgnoreEvent(e,t){if(e.type in d.global)return!0;let s=(0,u.t)(e.target,t,this.parent.ee);return!!d[s]&&!!d[s].ignoreAll||!!(d[s]&&e.type in d[s])}evtName(e){switch(e){case"keydown":case"keyup":case"keypress":return"typing";case"mousemove":case"mouseenter":case"mouseleave":case"mouseover":case"mouseout":return"mousing";case"scroll":return"scrolling";case"touchstart":case"touchmove":case"touchend":case"touchcancel":case"touchenter":case"touchleave":return"touching";default:return e}}storeHist(e,t,s){this.#t()&&this.#s(new m("history.pushState",s,s,e,t))}#i=0;storeResources(e){if(e&&0!==e.length){for(let t=0;t<e.length;t++){let s=e[t];if((0|s.fetchStart)<=this.#i)continue;if(!this.#t())break;let{initiatorType:i,fetchStart:r,responseEnd:n,entryType:a}=s,{protocol:o,hostname:h,port:u,pathname:l}=(0,c.D)(s.name),d=new m(i,0|r,0|n,"".concat(o,"://").concat(h,":").concat(u).concat(l),a);this.#s(d)}this.#i=0|e[e.length-1].fetchStart}}storeErrorAgg(e,t,s,i){"err"===e&&this.#t()&&this.#s(new m("error",i.time,i.time,s.message,s.stackHash))}storeXhrAgg(e,t,s,i){"xhr"===e&&this.#t()&&this.#s(new m("Ajax",i.time,i.time+i.duration,"".concat(s.status," ").concat(s.method,": ").concat(s.host).concat(s.pathname),"ajax"))}isEmpty(){return 0===this.nodeCount}save(){this.#e=this.trace}get(){return[{targetApp:this.parent.agentRef.runtime.entityManager.get(),data:this.takeSTNs()}]}clear(){this.trace={},this.nodeCount=0,this.prevStoredEvents.clear(),this.earliestTimeStamp=1/0,this.latestTimeStamp=0}reloadSave(){for(let e of Object.values(this.#e))for(let t of e){if(!this.#t())return;this.#s(t)}}clearSave(){this.#e=void 0}}var f=s(42806),v=s(85341),T=s(56797),S=s(87516);class b extends n.r{static featureName=r.TZ;constructor(e){super(e,r.TZ),this.harvestOpts.raw=!0,this.entitled=void 0,this.everHarvested=!1,this.harvesting=!1,this.events=new p(this),this.waitForFlags(["sts","st"]).then(([e,t])=>this.initialize(e,t))}initialize(e,t,s){return(this.entitled??=t,this.entitled||(this.blocked=!0),this.blocked)?this.deregisterDrain():(this.initialized||(this.initialized=!0,this.ptid=this.agentRef.runtime.ptid,this.sessionId=this.agentRef.runtime.session?.state.value,this.ee.on(o.tS.RESET,()=>{this.blocked||this.abort(1)}),this.ee.on(o.tS.UPDATE,(e,t)=>{this.blocked||(this.mode!==o.g.FULL&&(t.sessionReplayMode===o.g.FULL||t.sessionTraceMode===o.g.FULL)&&this.switchToFull(),(this.sessionId!==t.value||"cross-tab"===e&&t.sessionTraceMode===o.g.OFF)&&this.abort(2))}),"undefined"!=typeof PerformanceNavigationTiming?this.events.storeTiming(a.gm.performance?.getEntriesByType?.("navigation")[0]):this.events.storeTiming(a.gm.performance?.timing,!0)),this.agentRef.runtime.session.isNew||s?this.mode=e:this.mode=this.agentRef.runtime.session.state.sessionTraceMode,this.mode===o.g.OFF)?this.deregisterDrain():void(this.timeKeeper??=this.agentRef.runtime.timeKeeper,(0,i.i)("bst",(...e)=>this.events.storeEvent(...e),this.featureName,this.ee),(0,i.i)("bstResource",(...e)=>this.events.storeResources(...e),this.featureName,this.ee),(0,i.i)("bstHist",(...e)=>this.events.storeHist(...e),this.featureName,this.ee),(0,i.i)("bstXhrAgg",(...e)=>this.events.storeXhrAgg(...e),this.featureName,this.ee),(0,i.i)("bstApi",(...e)=>this.events.storeNode(...e),this.featureName,this.ee),(0,i.i)("trace-jserror",(...e)=>this.events.storeErrorAgg(...e),this.featureName,this.ee),(0,i.i)("pvtAdded",(...e)=>this.events.processPVT(...e),this.featureName,this.ee),this.mode!==o.g.FULL&&(0,i.i)("trace-jserror",()=>{this.mode===o.g.ERROR&&this.switchToFull()},this.featureName,this.ee),this.agentRef.runtime.session.write({sessionTraceMode:this.mode}),this.drain(),this.agentRef.runtime.harvester.triggerHarvestFor(this))}preHarvestChecks(){if(!this.blocked&&this.mode===o.g.FULL&&this.timeKeeper?.ready&&this.agentRef.runtime.session){if(this.sessionId!==this.agentRef.runtime.session.state.value||this.ptid!==this.agentRef.runtime.ptid){this.abort(3);return}return!0}}serializer({stns:e}){if(e.length)return this.everHarvested=!0,(0,v.G)(e,this.obfuscator.obfuscateString.bind(this.obfuscator),"string")}queryStringsBuilder({stns:e,earliestTimeStamp:t,latestTimeStamp:s}){let i=!this.agentRef.runtime.session.state.traceHarvestStarted;i&&this.agentRef.runtime.session.write({traceHarvestStarted:!0});let r=1===this.agentRef.runtime.session.state.sessionReplayMode,n=this.agentRef.info.jsAttributes["enduser.id"],a=this.agentRef.runtime.appMetadata.agents?.[0]?.entityGuid;return{browser_monitoring_key:this.agentRef.info.licenseKey,type:"BrowserSessionChunk",app_id:this.agentRef.info.applicationID,protocol_version:"0",timestamp:Math.floor(this.timeKeeper.correctRelativeTimestamp(t)),attributes:(0,f.WL)({...a&&{entityGuid:a},harvestId:"".concat(this.agentRef.runtime.session.state.value,"_").concat(this.agentRef.runtime.ptid,"_").concat(this.agentRef.runtime.harvestCount),"trace.firstTimestamp":Math.floor(this.timeKeeper.correctRelativeTimestamp(t)),"trace.lastTimestamp":Math.floor(this.timeKeeper.correctRelativeTimestamp(s)),"trace.nodes":e.length,"trace.originTimestamp":this.timeKeeper.correctedOriginTime,agentVersion:this.agentRef.runtime.version,...i&&{firstSessionHarvest:i},...r&&{hasReplay:r},ptid:"".concat(this.ptid),session:"".concat(this.sessionId),...n&&{"enduser.id":this.obfuscator.obfuscateString(n)},currentUrl:this.obfuscator.obfuscateString((0,T.L)(""+location))},5e3).substring(1)}}switchToFull(){if(this.mode===o.g.FULL||!this.entitled||this.blocked)return;let e=this.mode;if(this.mode=o.g.FULL,this.agentRef.runtime.session.write({sessionTraceMode:this.mode}),e===o.g.OFF||!this.initialized)return this.initialize(this.mode,this.entitled);this.initialized&&(this.events.trimSTNs(3e4),this.agentRef.runtime.harvester.triggerHarvestFor(this))}abort(e){(0,S.R)(60,e),this.blocked=!0,this.mode=o.g.OFF,this.agentRef.runtime.session.write({sessionTraceMode:this.mode}),this.events.clear()}}},61410:(e,t,s)=>{s.d(t,{t:()=>i});function i(e,t,s){let i="unknown";if(e&&e instanceof XMLHttpRequest){let t=s.context(e).params;if(!t||!t.status||!t.method||!t.host||!t.pathname)return"xhrOriginMissing";i=t.status+" "+t.method+": "+t.host+t.pathname}else if(e&&"string"==typeof e.tagName&&(i=e.tagName.toLowerCase(),e.id&&(i+="#"+e.id),e.className))for(let t=0;t<e.classList.length;t++)i+="."+e.classList[t];return"unknown"===i&&("string"==typeof t?i=t:t===document?i="document":t===window?i="window":t instanceof FileReader&&(i="FileReader")),i}},85341:(e,t,s)=>{s.d(t,{G:()=>function e(t,s,i="string",r=[]){return t&&"object"==typeof t&&Object.keys(t).forEach(n=>{"object"==typeof t[n]?e(t[n],s,i,r):typeof t[n]!==i||r.includes(n)||(t[n]=s(t[n]))}),t}})}}]);