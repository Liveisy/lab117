"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8916],{11297:(t,e,r)=>{r.d(e,{It:()=>s,No:()=>a,uh:()=>i});let a=64e3,s=1e6,i="NR_CONTAINER_AGENT"},42200:(t,e,r)=>{r.d(e,{p:()=>s});var a=r(8068);function s(){return a.gm?.location?.protocol==="file:"}},42806:(t,e,r)=>{r.d(e,{WL:()=>u,uR:()=>h});var a=r(29452),s={"%2C":",","%3A":":","%2F":"/","%40":"@","%24":"$","%3B":";"},i=RegExp(Object.keys(s).join("|"),"g");function n(t){return s[t]}function o(t){return null==t?"null":encodeURIComponent(t).replace(i,n)}function u(t,e){var r=0,s="";return Object.entries(t||{}).forEach(([t,i])=>{var n,u,h=[];if("string"==typeof i||!Array.isArray(i)&&null!=i&&i.toString().length)n="&"+t+"="+o(i),r+=n.length,s+=n;else if(Array.isArray(i)&&i.length){for(r+=9,u=0;u<i.length&&(n=o((0,a.A)(i[u])),r+=n.length,void 0===e||!(r>=e));u++)h.push(n);s+="&"+t+"=%5B"+h.join(",")+"%5D"}}),s}function h(t,e,r={}){return Object.keys(r).includes(t)?"":e&&"string"==typeof e?"&"+t+"="+o(e):""}},56797:(t,e,r)=>{r.d(e,{L:()=>i});var a=/([^?#]*)[^#]*(#[^?]*|$).*/,s=/([^?#]*)().*/;function i(t,e){return t.replace(e?a:s,"$1$2")}},91907:(t,e,r)=>{r.d(e,{Z:()=>i});var a=r(29452),s=r(11297);class i{#t=[];#e=0;#r;#a;constructor(t=s.It){this.maxPayloadSize=t}isEmpty(){return 0===this.#t.length}get(){return this.#t}byteSize(){return this.#e}wouldExceedMaxSize(t){return this.#e+t>this.maxPayloadSize}add(t){let e=a.A(t)?.length||0;return!(this.#e+e>this.maxPayloadSize)&&(this.#t.push(t),this.#e+=e,!0)}clear(){this.#t=[],this.#e=0}save(){this.#r=this.#t,this.#a=this.#e}clearSave(){this.#r=void 0,this.#a=void 0}reloadSave(){this.#r&&(this.#a+this.#e>this.maxPayloadSize||(this.#t=[...this.#r,...this.#t],this.#e=this.#a+this.#e))}}},98916:(t,e,r)=>{r.d(e,{r:()=>z});var a=r(3994),s=r(54821),i=r(63626),n=r(50772),o=r(12525),u=r(6677),h=r(42200),c=r(87516);class g{constructor(t){this.agentRef=t,this.warnedRegexMissing=!1,this.warnedInvalidRegex=!1,this.warnedInvalidReplacement=!1}get obfuscateConfigRules(){return this.agentRef.init.obfuscate||[]}obfuscateString(t){if("string"!=typeof t||0===t.trim().length)return t;let e=this.obfuscateConfigRules.map(t=>this.validateObfuscationRule(t));return(0,h.p)()&&e.push({regex:/^file:\/\/(.*)/,replacement:atob("ZmlsZTovL09CRlVTQ0FURUQ=")}),e.filter(t=>t.isValid).reduce((t,e)=>{let{rule:r}=e;return t.replace(r.regex,r.replacement||"*")},t)}validateObfuscationRule(t){let e=void 0===t.regex,r=!(void 0===t.regex||"string"==typeof t.regex||t.regex instanceof RegExp),a=!!(t.replacement&&"string"!=typeof t.replacement);return e&&!this.warnedRegexMissing?((0,c.R)(12,t),this.warnedRegexMissing=!0):r&&!this.warnedInvalidRegex&&((0,c.R)(13,t),this.warnedInvalidRegex=!0),a&&!this.warnedInvalidReplacement&&((0,c.R)(14,t),this.warnedInvalidReplacement=!0),{rule:t,isValid:!e&&!r&&!a,errors:{regexMissingDetected:e,invalidRegexDetected:r,invalidReplacementDetected:a}}}}var l=r(56804),d=r(11297),f=r(3567),p=r(2162);class v{constructor(t,e,r,a){this.agentRef=t,this.entityManager=t.runtime.entityManager,this.StorageClass=e,this.appStorageMap=new Map([[d.uh,new this.StorageClass]]),this.featureName=a,this.setEventStore(r)}#s(t=d.uh){return this.appStorageMap.has(t)||this.setEventStore(t),this.appStorageMap.get(t)}setEventStore(t){if(!t)return;let e=(0,p.A)(this.entityManager.get(t),this.agentRef)?this.appStorageMap.get(d.uh):new this.StorageClass;this.appStorageMap.set(t,e)}isEmpty(t,e){if(e)return this.#s(e).isEmpty(t);for(let e of this.appStorageMap.values())if(!e.isEmpty(t))return!1;return!0}add(t,e){return(0,f.W)({agentIdentifier:this.agentRef.agentIdentifier,drained:!!u.B?.[this.agentRef.agentIdentifier],type:"data",name:"buffer",feature:this.featureName,data:t}),this.#s(e).add(t)}addMetric(t,e,r,a){return this.#s().addMetric(t,e,r,a)}get(t,e){if(e)return[{targetApp:this.entityManager.get(e),data:this.#s(e).get(t)}];let r=[];return this.appStorageMap.forEach((e,a)=>{if(a===d.uh)return;let s=this.entityManager.get(a);s&&r.push({targetApp:s,data:e.get(t)})}),r}byteSize(t){return this.#s(t).byteSize()}wouldExceedMaxSize(t,e){return this.#s(e).wouldExceedMaxSize(t)}save(t,e){if(e)return this.#s(e).save(t);this.appStorageMap.forEach(e=>e.save(t))}clear(t,e){if(e)return this.#s(e).clear(t);this.appStorageMap.forEach(e=>e.clear(t))}reloadSave(t,e){return this.#s(e).reloadSave(t)}clearSave(t,e){return this.#s(e).clearSave(t)}}var y=r(94581),m=r(67216),b=r(8068),R=r(48532),S=r(89578),k=r(40775),E=r(9219);if(b.bv){b.gm.cleanupTasks=[];let t=b.gm.close;b.gm.close=()=>{for(let t of b.gm.cleanupTasks)t();t()}}var w=r(56797),x=r(42806),B=r(29452);function M({url:t,body:e=null,method:r="POST",headers:a=[{key:"content-type",value:"text/plain"}]}){let s={};for(let t of a)s[t.key]=t.value;return fetch(t,{headers:s,method:r,body:e,credentials:"include"})}function A({url:t,body:e=null,sync:r,method:a="POST",headers:s=[{key:"content-type",value:"text/plain"}]}){let i=new XMLHttpRequest;i.open(a,t,!r);try{"withCredentials"in i&&(i.withCredentials=!0)}catch(t){}return s.forEach(t=>{i.setRequestHeader(t.key,t.value)}),i.send(e),i}function O({url:t,body:e}){try{return window.navigator.sendBeacon.bind(window.navigator)(t,e)}catch(t){return!1}}class I{#i=!1;initializedAggregates=[];constructor(t){this.agentRef=t,function(t,e){b.RI?(0,E.u)(t,!0,e):b.bv&&b.gm.cleanupTasks.push(t)}(()=>{this.initializedAggregates.forEach(t=>{"function"==typeof t.harvestOpts.beforeUnload&&t.harvestOpts.beforeUnload()}),this.initializedAggregates.forEach(t=>this.triggerHarvestFor(t,{isFinalHarvest:!0}))},!1)}startTimer(t=this.agentRef.init.harvest.interval){if(this.#i)return;this.#i=!0;let e=()=>{this.initializedAggregates.forEach(t=>this.triggerHarvestFor(t)),setTimeout(e,1e3*t)};setTimeout(e,1e3*t)}triggerHarvestFor(t,e={}){let r;if(t.blocked)return!1;let a=function({isFinalHarvest:t=!1}={}){return t&&b.RI?O:"undefined"!=typeof XMLHttpRequest?A:M}(e);if(!a)return!1;let s=!e.isFinalHarvest&&a===A,i=!1;if(e.directSend)r=[e.directSend];else if(!(r=t.makeHarvestPayload(s,e)))return!1;return r.forEach(({targetApp:r,payload:s})=>{s&&(function(t,{endpoint:e,targetApp:r,payload:a,localOpts:s={},submitMethod:i,cbFinished:n,raw:o,featureName:h}){if(!t.info.errorBeacon)return 0;let{body:g,qs:d}=function(t={}){let e=t=>"undefined"!=typeof Uint8Array&&t instanceof Uint8Array||Array.isArray(t)?t:"string"==typeof t?t.length>0?t:null:Object.entries(t||{}).reduce((t,[e,r])=>(("number"==typeof r||"string"==typeof r&&r.length>0||"object"==typeof r&&Object.keys(r||{}).length>0)&&(t[e]=r),t),{});return{body:e(t.body),qs:e(t.qs)}}(a);if(0===Object.keys(g).length&&!s.sendEmptyBody)return n&&n({sent:!1,targetApp:r}),0;let p=!1===t.init.ssl?"http":"https",v=t.init.proxy.beacon||t.info.errorBeacon,y=o?"".concat(p,"://").concat(v,"/").concat(e):"".concat(p,"://").concat(v).concat(e!==l.v4?"/"+e:"","/1/").concat(r.licenseKey),R=o?"":function(t,e,r,a){let s=t.runtime.obfuscator.obfuscateString((0,w.L)(""+b.gm.location)),i=t.runtime.session?.state.sessionReplayMode===1&&r!==l.XX,n=t.runtime.session?.state.sessionTraceMode===1&&![l.Yy,l.df].includes(r),o=["a="+a,(0,x.uR)("sa",t.info.sa?""+t.info.sa:""),(0,x.uR)("v",m.xv),t.info.transactionName?(0,x.uR)("to",t.info.transactionName):(0,x.uR)("t",t.info.tNamePlain||"Unnamed Transaction"),(0,x.uR)("ct",t.runtime.customTransaction),"&rst="+(0,k.t)(),"&ck=0","&s="+(t.runtime.session?.state.value||"0"),(0,x.uR)("ref",s),(0,x.uR)("ptid",t.runtime.ptid?""+t.runtime.ptid:"")];return i&&o.push((0,x.uR)("hr","1",e)),n&&o.push((0,x.uR)("ht","1",e)),o.join("")}(t,d,e,r.applicationID),E=(0,x.WL)(d,t.runtime.maxBytes);""===R&&E.startsWith("&")&&(E=E.substring(1));let O="".concat(y,"?").concat(R).concat(E);!d?.attributes?.includes("gzip")&&(e!==l.qY&&(g=(0,B.A)(g)),g.length>75e4&&1===(T[e]=(T[e]||0)+1)&&(0,c.R)(28,e)),g&&0!==g.length&&"{}"!==g&&"[]"!==g||(g="");let I=[{key:"content-type",value:"text/plain"}],C=i({url:O,body:g,sync:s.isFinalHarvest&&b.bv,headers:I});return!s.isFinalHarvest&&n&&(i===A?C.addEventListener("loadend",function(){let t={sent:0!==this.status,status:this.status,retry:N(this.status),fullUrl:O,xhr:this,targetApp:r};s.needResponse&&(t.responseText=this.responseText),n(t)},(0,S.jT)(!1)):i===M&&C.then(async function(t){let e=t.status,a={sent:!0,status:e,retry:N(e),fullUrl:O,fetchResponse:t,targetApp:r};s.needResponse&&(a.responseText=await t.text()),n(a)})),(0,f.W)({agentIdentifier:t.agentIdentifier,drained:!!u.B?.[t.agentIdentifier],type:"data",name:"harvest",feature:h,data:{endpoint:e,headers:I,targetApp:r,payload:a,submitMethod:i===A?"xhr":i===M?"fetch":"beacon",raw:o,synchronousXhr:!!(s.isFinalHarvest&&b.bv)}});function N(t){switch(t){case 408:case 429:case 500:return!0}return t>=502&&t<=504||t>=512&&t<=530}}(this.agentRef,{endpoint:l.$J[t.featureName],targetApp:r,payload:s,localOpts:e,submitMethod:a,cbFinished:n,raw:t.harvestOpts.raw,featureName:t.featureName}),i=!0)}),i;function n(r){t.harvestOpts.prevAttemptCode&&((0,R.p)(y.xV,[(r.retry?"Harvester/Retry/Failed/":"Harvester/Retry/Succeeded/")+t.harvestOpts.prevAttemptCode],void 0,l.K7.metrics,t.ee),delete t.harvestOpts.prevAttemptCode),r.retry&&(t.harvestOpts.prevAttemptCode=r.status),e.forceNoRetry&&(r.retry=!1),t.postHarvestCleanup(r)}}}let T={};class C{#n=new Map;#o={};constructor(t){this.agentRef=t,this.#n.set(d.uh,{licenseKey:t.info.licenseKey,applicationID:t.info.applicationID})}get(t=d.uh){return this.#n.get(t)}getEntityGuidFor(t,e){if(this.#o[t]&&this.#o[e])return this.#o[t].filter(t=>this.#o[e].includes(t))[0]}set(t,e){this.#n.has(t)||(this.#n.set(t,e),this.#o[e.licenseKey]??=[],this.#o[e.licenseKey].push(t),this.#o[e.applicationID]??=[],this.#o[e.applicationID].push(t),this.agentRef.ee.emit("entity-added",[e]))}clear(){this.#n.clear()}setDefaultEntity(t){this.#n.set(d.uh,t)}}var N=r(91907);class G{constructor(){this.aggregatedData={}}store(t,e,r,a,s){var i,n,o=this.#u(t,e,r,s);return i=a,(n=o.metrics)||(n={count:0}),n.count+=1,Object.entries(i||{}).forEach(([t,e])=>{n[t]=j(e,n[t])}),o.metrics=n,o}merge(t,e,r,a,s,i=!1){var n=this.#u(t,e,a,s);if(i&&(n.params=a),!n.metrics){n.metrics=r;return}var o=n.metrics;o.count+=r.count,Object.keys(r||{}).forEach(t=>{if("count"!==t){var e,a,s=o[t],i=r[t];i&&!i.c?o[t]=j(i.t,s):o[t]=(e=i,(a=o[t])?(a.c||(a=D(a.t)),a.min=Math.min(e.min,a.min),a.max=Math.max(e.max,a.max),a.t+=e.t,a.sos+=e.sos,a.c+=e.c,a):e)}})}storeMetric(t,e,r,a){var s=this.#u(t,e,r);return s.stats=j(a,s.stats),s}take(t,e=!0){for(var r={},a="",s=!1,i=0;i<t.length;i++)r[a=t[i]]=Object.values(this.aggregatedData[a]||{}),r[a].length&&(s=!0),e&&delete this.aggregatedData[a];return s?r:null}#u(t,e,r,a){this.aggregatedData[t]||(this.aggregatedData[t]={});var s=this.aggregatedData[t][e];return!s&&(s=this.aggregatedData[t][e]={params:r||{}},a&&(s.custom=a)),s}}function j(t,e){var r;return null==t?((r=e)?r.c++:r={c:1},r):e?(e.c||(e=D(e.t)),e.c+=1,e.t+=t,e.sos+=t*t,t>e.max&&(e.max=t),t<e.min&&(e.min=t),e):{t:t}}function D(t){return{t:t,min:t,max:t,sos:t*t,c:1}}class H{#h=new G;#c={};isEmpty({aggregatorTypes:t}){return t?t.every(t=>!this.#h.aggregatedData[t]):0===Object.keys(this.#h.aggregatedData).length}add([t,e,r,a,s]){return this.#h.store(t,e,r,a,s),!0}addMetric(t,e,r,a){return this.#h.storeMetric(t,e,r,a),!0}save({aggregatorTypes:t}){let e=t.toString(),r={};t.forEach(t=>r[t]=this.#h.aggregatedData[t]),this.#c[e]=r}get(t){let e=Array.isArray(t)?t:t.aggregatorTypes;return this.#h.take(e,!1)}clear({aggregatorTypes:t}={}){if(!t){this.#h.aggregatedData={};return}t.forEach(t=>delete this.#h.aggregatedData[t])}reloadSave({aggregatorTypes:t}){let e=t.toString(),r=this.#c[e];t.forEach(t=>{Object.keys(r[t]||{}).forEach(e=>{let a=r[t][e];this.#h.merge(t,e,a.metrics,a.params,a.custom,!0)})})}clearSave({aggregatorTypes:t}){let e=t.toString();delete this.#c[e]}}class z extends a.W{constructor(t,e){super(t.agentIdentifier,e),this.agentRef=t,this.checkConfiguration(t),this.doOnceForAllAggregate(t),this.harvestOpts={};let r=this.agentRef?.runtime?.appMetadata?.agents?.[0]?.entityGuid;this.#g(r),r||this.ee.on("entity-added",t=>{this.events?.setEventStore?.(t.entityGuid)})}#g(t){if(!this.events)switch(this.featureName){case l.K7.sessionTrace:case l.K7.sessionReplay:break;case l.K7.jserrors:case l.K7.metrics:this.events=this.agentRef.sharedAggregator??=new v(this.agentRef,H,t,"shared_aggregator");break;default:this.events=new v(this.agentRef,N.Z,t,this.featureName)}}waitForFlags(t=[]){return new Promise((e,r)=>{u.B[this.agentIdentifier]?e(a(u.B[this.agentIdentifier])):this.ee.on("rumresp",(t={})=>{e(a(t))});function a(e){return t.map(t=>e[t]?e[t]:0)}}).catch(t=>{this.ee.emit("internal-error",[t]),this.blocked=!0,this.deregisterDrain()})}drain(){(0,o.Ze)(this.agentIdentifier,this.featureName),this.drained=!0}preHarvestChecks(t){return!this.blocked}makeHarvestPayload(t=!1,e={}){if(!this.events||this.events.isEmpty(this.harvestOpts,e.targetEntityGuid)||this.preHarvestChecks&&!this.preHarvestChecks(e))return;t&&this.events.save(this.harvestOpts,e.targetEntityGuid);let r=this.events.get(this.harvestOpts,e.targetEntityGuid);return r.length?(this.events.clear(this.harvestOpts,e.targetEntityGuid),r.map(({targetApp:t,data:e})=>{let r={body:this.serializer?this.serializer(e,t?.entityGuid):e};return this.queryStringsBuilder&&(r.qs=this.queryStringsBuilder(e,t?.entityGuid)),{targetApp:t,payload:r}})):(0,c.R)(52)}postHarvestCleanup(t={}){t.sent&&t.retry&&this.events.reloadSave(this.harvestOpts,t.targetApp?.entityGuid),this.events.clearSave(this.harvestOpts,t.targetApp?.entityGuid)}checkConfiguration(t){if(!(0,s.f)(t.info)){let e=(0,n.pV)(),r={...e.info?.jsAttributes};try{r={...r,...t.info?.jsAttributes}}catch(t){}(0,i.j)(t,{...e,info:{...e.info,jsAttributes:r},runtime:t.runtime},t.runtime.loaderType)}}doOnceForAllAggregate(t){t.runtime.obfuscator||(t.runtime.obfuscator=new g(t)),this.obfuscator=t.runtime.obfuscator,t.runtime.entityManager||(t.runtime.entityManager=new C(this.agentRef)),t.runtime.harvester||(t.runtime.harvester=new I(t))}reportSupportabilityMetric(t,e){(0,R.p)(y.xV,[t,e],void 0,l.K7.metrics,this.ee)}}}}]);