"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6609],{46609:(e,i,t)=>{t.d(i,{A:()=>eN});var a=t(50014),r=t(14232),n=t(70819),o=t(32004),l=t(10241),u=t(33244),d=function(e){return e.UNKNOWN="ADPLACE_UNKNOWN",e.DISCLAIMER="DISCLAIMER",e.EXITPAGE="EXIT_PAGE",e.INBOUNDCALL="INBOUND_CALL",e.LISTING="LISTING",e.PARTNERREDIRECT="PARTNER_REDIRECT",e}({}),s=function(e){return e.UNKNOWN="UNKNOWN",e.ARRIVAL="ARRIVAL",e.POPUNDER="POP_UNDER",e.POSTFORM="POST_FORM",e.POSTS1="POST_S1",e.VPNPOST="VPN_POST",e}({}),c=function(e){return e.POPUNDER="LEADSTAGE_POP_UNDER",e.POSTFORM="LEADSTAGE_POST_FORM",e.ARRIVAL="LEADSTAGE_ARRIVAL",e.IVR="LEADSTAGE_IVR",e.VPNPING="LEADSTAGE_VPN_PING",e.VPNPOST="LEADSTAGE_VPN_POST",e.POSTS1="LEADSTAGE_POST_S1",e.PING="LEADSTAGE_PING",e.MSPOSTFORM="LEADSTAGE_MS_POST_FORM",e.MSPING="LEADSTAGE_MS_PING",e}({}),E=function(e){return e.UNKNOWN="UNKNOWN",e.EFC="EFC",e.FC="FC",e.LL="LL",e.ML="ML",e}({}),v=function(e){return e.UNKNOWN="UNKNOWN",e.AVERAGE="AVERAGE",e.EXCELLENT="EXCELLENT",e.GOOD="GOOD",e.POOR="POOR",e}({}),_=function(e){return e.UNKNOWN="UNKNOWN",e.ASSOCIATES="ASSOCIATES",e.BACHELORS="BACHELORS",e.DOCTORATE="DOCTORATE",e.GED="GED",e.HIGHSCHOOLDIPLOMA="HIGH_SCHOOL_DIPLOMA",e.MASTERS="MASTERS",e.OTHERNONPROFESSIONALDEGREE="OTHER_NONPROFESSIONAL_DEGREE",e.OTHERPROFESSIONALDEGREE="OTHER_PROFESSIONAL_DEGREE",e.SOMECOLLEGE="SOME_COLLEGE",e.SOMEORNOHIGHSCHOOL="SOME_OR_NO_HIGH_SCHOOL",e.TRADEVOCATIONALSCHOOL="TRADE_VOCATIONAL_SCHOOL",e}({}),N=function(e){return e.UNKNOWN="UNKNOWN",e.FEMALE="FEMALE",e.MALE="MALE",e.NONBINARY="NON_BINARY",e}({}),O=function(e){return e.UNKNOWN="UNKNOWN",e.DIVORCED="DIVORCED",e.MARRIED="MARRIED",e.SINGLE="SINGLE",e.WIDOWED="WIDOWED",e}({}),S=function(e){return e.UNKNOWN="UNKNOWN",e.ADMINISTRATIVECLERICAL="ADMINISTRATIVE_CLERICAL",e.ARCHITECT="ARCHITECT",e.BUSINESSOWNER="BUSINESS_OWNER",e.CERTIFIEDPUBLICACCOUNTANT="CERTIFIED_PUBLIC_ACCOUNTANT",e.CLERGY="CLERGY",e.CONSTRUCTIONTRADES="CONSTRUCTION_TRADES",e.DENTIST="DENTIST",e.DISABLED="DISABLED",e.ENGINEER="ENGINEER",e.HOMEMAKER="HOMEMAKER",e.LAWYER="LAWYER",e.MANAGERSUPERVISOR="MANAGER_SUPERVISOR",e.MILITARYENLISTED="MILITARY_ENLISTED",e.MILITARYOFFICER="MILITARY_OFFICER",e.MINORNOTAPPLICABLE="MINOR_NOT_APPLICABLE",e.OTHERNONTECHNICAL="OTHER_NON_TECHNICAL",e.OTHERTECHNICAL="OTHER_TECHNICAL",e.PHYSICIAN="PHYSICIAN",e.PROFESSIONALSALARIED="PROFESSIONAL_SALARIED",e.PROFESSOR="PROFESSOR",e.RETAIL="RETAIL",e.RETIRED="RETIRED",e.SALESINSIDE="SALES_INSIDE",e.SALESOUTSIDE="SALES_OUTSIDE",e.SCHOOLTEACHER="SCHOOL_TEACHER",e.SCIENTIST="SCIENTIST",e.SELFEMPLOYED="SELF_EMPLOYED",e.SKILLEDSEMISKILLED="SKILLED_SEMI_SKILLED",e.STUDENT="STUDENT",e.UNEMPLOYED="UNEMPLOYED",e}({}),A=function(e){return e.UNKNOWN="UNKNOWN",e.CHILD="CHILD",e.GRANDCHILD="GRANDCHILD",e.GRANDPARENT="GRANDPARENT",e.OTHER="OTHER",e.PARENT="PARENT",e.SIBLING="SIBLING",e.SPOUSE="SPOUSE",e.SELF="SELF",e}({}),I=function(e){return e.UNKNOWN="UNKNOWN",e.PRIMARYRESIDENCE="PRIMARY_RESIDENCE",e.SEASONALRESIDENCE="SEASONAL_RESIDENCE",e.TENANTOCCUPIED="TENANT_OCCUPIED",e.VACATION="VACATION",e}({}),p=function(e){return e.UNKNOWN="UNKNOWN",e.OWN="OWN",e.RENT="RENT",e.HOTELMOTEL="HOTEL_MOTEL",e.OTHER="OTHER",e}({}),R=function(e){return e.UNKNOWN="UNKNOWN",e.ASPHALTSHINGLE="ASPHALT_SHINGLE",e.COMPOSITIONSHINGLE="COMPOSITION_SHINGLE",e.FLATROOF="FLAT_ROOF",e.METALROOF="METAL_ROOF",e.OTHER="OTHER",e.TILESHINGLE="TILE_SHINGLE",e.WOODSHINGLE="WOOD_SHINGLE",e}({}),L=function(e){return e.UNKNOWN="UNKNOWN",e.FINANCED="FINANCED",e.LEASED="LEASED",e.OWNED="OWNED",e}({}),T=function(e){return e.UNKNOWN="UNKNOWN",e.BUSINESS="BUSINESS",e.COMMUTE="COMMUTE",e.FARM="FARM",e.PLEASURE="PLEASURE",e}({}),m=function(e){return e.UNKNOWN="UNKNOWN",e.CONDOMINIUM="CONDOMINIUM",e.DUPLEX="DUPLEX",e.MOBILEHOME="MOBILE_HOME",e.MULTIFAMILY="MULTI_FAMILY",e.SINGLEFAMILY="SINGLE_FAMILY",e.TOWNHOME="TOWNHOME",e}({});let g=e=>{var i;let{defaultValue:t,preProcessing:a,originalValue:r,targetEnum:n}=e,o=null!==(i=null==a?void 0:a(r))&&void 0!==i?i:r;return o&&n?Object.values(n).find(e=>e===o):null!=t?t:void 0},f=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.toUpperCase(),originalValue:e,targetEnum:d}),P=e=>g({defaultValue:void 0,originalValue:e,targetEnum:c}),C=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("CT_",""),originalValue:e,targetEnum:E}),D=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("CR_",""),originalValue:e,targetEnum:v}),h=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("EDU_",""),originalValue:e,targetEnum:_}),M=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("GEN_",""),originalValue:e,targetEnum:N}),U=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("MAR_",""),originalValue:e,targetEnum:O}),y=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("OCC_",""),originalValue:e,targetEnum:S}),b=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("REL_",""),originalValue:e,targetEnum:A}),k=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("IMP_",""),originalValue:e,targetEnum:s}),H=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("OCP_",""),originalValue:e,targetEnum:I}),G=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("PROP_",""),originalValue:e,targetEnum:m}),V=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("RES_",""),originalValue:e,targetEnum:p}),F=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("ROOF_",""),originalValue:e,targetEnum:R}),W=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("OWN_",""),originalValue:e,targetEnum:L}),q=e=>g({defaultValue:void 0,preProcessing:e=>null==e?void 0:e.replace("USE_",""),originalValue:e,targetEnum:T});var K=t(62931);let w=(e,i)=>e[i],B=(e,i)=>{var t;let a=["first","second","third"],r=null!==(t=e.driverCount)&&void 0!==t?t:1,n=i=>w(e,i);return Array.from({length:r},(t,r)=>{let o=a[r],l=0===r,u=()=>{var t;if(l)return{city:e.city,county:e.county,state:e.state,street_line_1:e.streetAddress,zip:null!==(t=e.zip)&&void 0!==t?t:i}};return{aaa_membership:l?e.aaaMembership:void 0,aarp_membership:l?e.aarp:void 0,birth_date:(()=>{let e=n("".concat(o,"PersonBirthYear")),i=n("".concat(o,"PersonBirthMonth")),t=n("".concat(o,"PersonBirthDay"));return t&&i&&e?{day:t,month:i,year:e}:void 0})(),dui:n("".concat(o,"DriverDUI")),education:h(n("".concat(o,"DriverEducation"))),first_name:n("".concat(o,"PersonFirstName")),gender:M(n("".concat(o,"DriverGender"))),last_name:n("".concat(o,"PersonLastName")),license_ever_suspended_or_revoked:n("".concat(o,"DriverSuspendedRevoked")),marital_status:U(n("".concat(o,"DriverMarriage"))),military_service:l?e.militaryService:n("".concat(o,"DriverMilitaryService")),occupation:y(n("".concat(o,"DriverOccupation"))),primary_address:u(),relationship:b(l?K.iT.SELF:n("".concat(o,"DriverRelationToPrimary"))),residential_status:l?V(e.residenceOwnership):void 0,self_credit_rating:l?D(e.creditScore):void 0,sr22_required:n("".concat(o,"DriverDUI")),standardized_address:u(),contact_info:{email:l?e.email:void 0,primary_phone_number:l?e.phone:void 0}}})},x=e=>{let i=["first","second","third"],t=1;e.addSecondVehicle&&(t=2),e.addThirdVehicle&&(t=3);let a=i=>w(e,i);return Array.from({length:t},(e,t)=>{let r="".concat(i[t],"Vehicle");return{miles_driven_per_year:a("".concat(r,"Mileage")),make:a("".concat(r,"Make")),model:a("".concat(r,"Model")),ownership_status:W(a("".concat(r,"Ownership"))),primary_use:q(a("".concat(r,"PrimaryUse"))),standardization_lookup_type:"by_year_make_model",standardized_make:a("".concat(r,"Make")),standardized_model:a("".concat(r,"Model")),standardized_year:a("".concat(r,"Year")),year:a("".concat(r,"Year"))}})},Y=e=>e?{coverage_type:C(e.firstVehicleCoverageType),current_insurer:e.currentInsurer,insured:e.insured,insured_duration_months:e.monthsInsured,vehicles:x(e)}:{},z=(e,i)=>[{birth_date:(()=>{let i=e.firstPersonBirthYear,t=e.firstPersonBirthMonth,a=e.firstPersonBirthDay;return a&&t&&i?{day:a,month:t,year:i}:void 0})(),first_name:e.firstPersonFirstName,gender:M(e.gender),last_name:e.firstPersonLastName,military_service:e.militaryService,primary_address:(()=>{var t;return{city:e.city,county:e.county,state:e.state,street_line_1:e.streetAddress,zip:null!==(t=e.zip)&&void 0!==t?t:i}})(),contact_info:{email:e.email,primary_phone_number:e.phone}}],Q=e=>{let i={city:e.city,county:e.county,state:e.state,street_line_1:e.streetAddress,zip:e.zip};return{address:i,bathrooms:e.bathrooms,bedrooms:e.bedrooms,occupancy:H(e.propertyPrimaryUse),property_type:G(e.propertyType),roof_type:F(e.roofType),square_feet:e.squareFootage,standardized_address:i,year_built:e.decadeBuilt}},j=e=>e?{current_insurer:e.currentInsurer,home:Q(e),insured:e.insured,insured_duration_months:e.monthsInsured}:{},X=e=>Array.isArray(e)&&0===e.length?[{match_names:["noSale"],normalized_name:"noSale",type:"noSale",logo:"noSale"}]:Array.isArray(e)?e.map(e=>({match_names:e.affiliationUlid?[e.affiliationUlid]:e.matchNames,normalized_name:e.normalizedName,type:e.type,logo:e.logo})):void 0,J=e=>{let{affiliationNormalized:i,affiliationUlid:t,campaignUuid:a}=e;if(i||t||a)return{ad:{campaign_uuid:a},affiliation_normalized:i,affiliation_ulid:t}},Z=e=>{var i;return"undefined"!=typeof document?null===(i=document.querySelector(e))||void 0===i?void 0:i.value:void 0},$=e=>{var i,t,a;let{affiliationNormalized:r,affiliationUlid:n,answers:o,arrival:l,blockedAffiliations:u,campaignUuid:d,domain:s,forceNoLeadSale:c,forceVpn:E,impressionPath:v,maxReferrals:_,pingLeadUuid:N,placement:O,stage:S,vertical:A,zipCode:I}=e,p=Z("#leadid_token"),R="s://".concat(l.attributes.host);return{ad_context:"captive",ad_placement:O,apollo:l.userExperience.apolloUser?"1":"0",arrival_uuid:l.uuid,bid:J({affiliationNormalized:r,affiliationUlid:n,campaignUuid:d}),blocked_affiliations:u,disclosure_text:o.disclosure_text,email_opt_in:o.emailOptIn,fake_ads:null!==(a=null===(t=l.attributes.queryString)||void 0===t?void 0:null===(i=t.oFakeAds)||void 0===i?void 0:i[0])&&void 0!==a?a:void 0,force_no_lead_sale:null!=c&&c,impression_path:v,max_referrals:_,phone_opt_in:o.phoneOptIn,ping_uuid:N,primary_insurance_type:"home"===A?"HOME":"AUTO",publisher_name:s,quote_service_url:"http".concat(R,"/wait-for-quote?sid=[service_quote_id]&ct=[click_token]&curl=[click_url]&auid=[arrival_uuid]"),reason_for_quote:"",ref_id:1540,require_ads:!0,require_quote:!1,selected_carriers:X(o.carrierSelection),stage:P(S),tcpa_shown:o.tcpaShown,tid:l.attributes.tid,traffic_tier:l.attributes.trafficTier,trusted_form_cert_url:l.attributes.trustedFormCertURL,universal_lead_id:p,vpn_lead:null!=E&&E,..."auto"===A&&{auto_insurance_info:Y(o),persons:B(o,I)},..."home"===A&&{home_insurance_info:j(o),persons:z(o,I)}}},ee=e=>({AdvertiserID:e.advertiser_id,AdvertiserName:e.advertiser_name,CustomAttributes:e.custom_attributes,Index:e.index,RedirectURL:e.redirect_url,SCClickToken:e.sc_click_token,Type:e.type}),ei=e=>{var i;return{Actions:null===(i=e.actions)||void 0===i?void 0:i.map(ee),AdvertiserName:e.carrier,BrandName:e.brand_name,CampaignUUID:e.campaign_uuid,DisplayedText:e.displayed_text,HomeCoverage:e.home_coverage,Index:e.index,LogoOrigPath:e.logo_orig_path,MotorcycleCoverage:e.motorcycle_coverage,OnlineApp:e.online_app,OnlineQuote:e.online_quote,Quoted:e.quoted,QuoteInAd:e.quote_in_ad,QuoteServiceID:e.quote_service_id,QuoteType:e.quote_type,RedirectURL:e.landing_url,SCClickToken:e.sc_click_token,Title:e.headline,UserAdState:e.user_ad_state}},et=e=>{var i;return{uuid:e.arrival_uuid,AssignedMatchesList:{AutoRedirect:e.auto_redirect,CallbackURL:e.callback_url,AssignedMatches:null===(i=e.bids)||void 0===i?void 0:i.map(e=>ei(e.ad)),PageRenderStartPixel:e.page_render_start_pixel,PageViewPixel:e.page_view_pixel,PingJobID:e.ping_job_id,Quoted:e.quoted,SCRequestToken:e.sc_request_token,SCListingToken:e.sc_listing_token},ErrorMessage:e.err_message}};var ea=t(28141);let er=async e=>{var i,t,a,r;let{affiliationNormalized:o,affiliationUlid:d,blockedAffiliations:s,campaignUuid:c,forceNoLeadSale:E,forceVpn:v,geo:_,impressionPath:N,isRetry:O,maxReferrals:S,pingLeadUuid:A,placement:I=K.lO.ExitPage,session:p,stage:R}=e,L=p.arrival,T=null!==(t=null===(i=p.attributes)||void 0===i?void 0:i.brand)&&void 0!==t?t:"marketplace",m=null!==(a=L.attributes.domain)&&void 0!==a?a:"",g=function(e){return"auto"===e||"home"===e?e:"auto"}(L.attributes.vertical),P=$({affiliationNormalized:o,affiliationUlid:d,answers:p.answers,arrival:L,blockedAffiliations:s,campaignUuid:c,domain:m,forceNoLeadSale:E,forceVpn:v,impressionPath:k(N),maxReferrals:S,pingLeadUuid:A,placement:f(I),stage:R,vertical:g,zipCode:null==_?void 0:_.zip}),C=await fetch("".concat(ea.wS,"/bids"),{body:JSON.stringify(P),headers:{Authorization:"Bearer ".concat(L.attributes.jwt),"Content-Type":"application/json"},method:"POST"});if(O?(0,l.W4)(u.K.ExchangeAcquisitionBidsRequest,+(null!=C&&!!C.ok),g,T):C.ok?(0,l.W4)(u.K.ExchangeAcquisitionBidsRequest,1,g,T):(0,l.W4)(u.K.ExchangeAcquisitionFirstBidsRequest,0,g,T),!C.ok){await n.t.error("Error returned from EAP /bids",{body:await C.text(),impressionPath:N,arrivalId:L.uuid,status:C.status,vertical:g,queryString:null===(r=L.attributes)||void 0===r?void 0:r.queryString});return}return et(await C.json())},en=e=>{let{arrival:i,allowResubmit:t,domain:a,forceNoLeadSale:r,forceVPN:n,insured:o,impressionPath:l,placement:u,state:d,queryString:s,vertical:c,zipCode:E,leadUuid:v,campaignUuid:_,affiliationNormalized:N,affiliationUlid:O,stage:S,blockedAffiliations:A,maxReferrals:I}=e;return{state:d,uuid:i.uuid,publisher_name:a,allow_resubmit:t,ad_context:"captive",assigned_match_placement:u,apollo:i.userExperience.apolloUser?"1":"0",currently_insured:o,fake_ads:s.oFakeAds?s.oFakeAds[0]:void 0,impression_path_v2:l,product:"".concat(c,"_lead"),quote_service_url:"http".concat("s://".concat(i.attributes.host),"/wait-for-quote?sid=[service_quote_id]&ct=[click_token]&curl=[click_url]&auid=[arrival_uuid]"),refid:"1540",require_ads:!0,require_quote:!1,visitor:{domain:a,uuid:i.attributes.visitorUUID},zipcode:E,lead_type:c,reason_for_quote:"",force_no_lead_sale:null!=r&&r,vpn_lead:null!=n&&n,lead_uuid:v,campaign_uuid:_,affiliation_normalized:N,affiliation_ulid:O,stage:S,blocked_affiliations:A,max_referrals:I}},eo=async(e,i,t)=>{var a,r,o;let{arrival:d,allowResubmit:s,forceNoLeadSale:c,forceVPN:E,geo:v,insured:_,placement:N=K.lO.ExitPage,impressionPath:O,leadUuid:S,campaignUuid:A,affiliationNormalized:I,affiliationUlid:p,stage:R,maxReferrals:L,blockedAffiliations:T}=e,m=null!==(a=d.attributes.vertical)&&void 0!==a?a:"auto",g=null!==(r=d.attributes.domain)&&void 0!==r?r:"",f=null!==(o=d.attributes.queryString)&&void 0!==o?o:{},{state:P,zip:C}=v,D=en({arrival:d,allowResubmit:s,domain:g,forceNoLeadSale:c,forceVPN:E,impressionPath:O,insured:_,placement:N,state:P,queryString:f,vertical:m,zipCode:C,leadUuid:S,campaignUuid:A,affiliationNormalized:I,affiliationUlid:p,stage:R,maxReferrals:L,blockedAffiliations:T}),h=await fetch("".concat(ea.pn,"/api/assigned_matches/").concat(m),{body:JSON.stringify(D),headers:{"Content-Type":"application/json"},credentials:"same-origin",method:"POST"});if(i?(0,l.W4)(u.K.OcelotAssignedMatchesRequest,+(null!=h&&!!h.ok),m,null!=t?t:"marketplace"):h.ok?(0,l.W4)(u.K.OcelotAssignedMatchesRequest,1,m,null!=t?t:"marketplace"):(0,l.W4)(u.K.OcelotFirstAssignedMatchesRequest,0,m,null!=t?t:"marketplace"),!h.ok){await n.t.error("Error returned from assigned matches",{body:await h.text(),impressionPath:O,arrivalId:d.uuid,status:h.status,vertical:m,queryString:f,state:P});return}return h.json()};var el=t(14367);let eu=async(e,i,t)=>{var a,r,n,o,d,s;let c=null!==(d=null==e?void 0:null===(r=e.arrival)||void 0===r?void 0:null===(a=r.attributes)||void 0===a?void 0:a.vertical)&&void 0!==d?d:"auto",E=i.Actions.find(e=>"click"===e.Type),v={action_token:null==E?void 0:E.SCClickToken,arrival_uuid:null==e?void 0:e.arrival.uuid,fake_ads:!!(null==e?void 0:null===(n=e.arrival.attributes.queryString)||void 0===n?void 0:n.oFakeAds),fallback_url:null==E?void 0:E.RedirectURL,impression_path_v2:t,index:i.Index,match_token:i.SCClickToken,sid:i.QuoteServiceID,visitor:{domain:null==e?void 0:e.arrival.attributes.domain,uuid:null==e?void 0:e.arrival.attributes.visitorUUID}},_=await fetch("".concat(ea.pn,"/api/quoted_assigned_match/").concat(c),{body:JSON.stringify(v),headers:{"Content-Type":"application/json"},credentials:"same-origin",method:"POST"});if((0,l.W4)(u.K.OcelotQuotedAssignedMatchesRequest,+(null!=_&&!!_.ok),c,null!==(s=null==e?void 0:null===(o=e.attributes)||void 0===o?void 0:o.brand)&&void 0!==s?s:"marketplace"),null==_?void 0:_.ok)return _.json()};var ed=t(10038),es=t(27196),ec=t(99231),eE=t(54893);let ev=e=>{var i,t;let{props:a,initSession:r,marketingServicesPartnerConfig:n,isPrefetchingAds:l}=e;a.maxReferrals=null!==(t=null===(i=r.damascusConfig)||void 0===i?void 0:i.global.marketingServicesMaxReferrals)&&void 0!==t?t:1,(null==n?void 0:n.restrictLeadSalesToCurrentPartner)||(a.blockedAffiliations=[null==n?void 0:n.affiliationUlid]),l||(a.allowResubmit=!0),a.stage=l?o.h.LEADSTAGE_MS_PING:void 0},e_=async(e,i,t,a,r)=>{var o,l,u,d,s,c,E,v,_,N,O,S,A,I,p,R,L,T,m;let g={AssignedMatches:[]},{arrival:f}=e,P=(0,es.e0)(e),C=(null==e?void 0:null===(l=e.answers)||void 0===l?void 0:null===(o=l.carrierSelection)||void 0===o?void 0:o.length)===0,D=null==e?void 0:null===(d=e.damascusConfig)||void 0===d?void 0:null===(u=d.global)||void 0===u?void 0:u.marketingServicesPartner,h=(0,ec.pA)(D),M=null==h?void 0:h.getConfig(),U=null==M?void 0:M.affiliationNormalized,y=null==M?void 0:M.affiliationUlid,b=D?(0,ec.ok)(D,e):void 0,k=null==e?void 0:null===(E=e.damascusConfig)||void 0===E?void 0:null===(c=E.global)||void 0===c?void 0:null===(s=c.marketingServices)||void 0===s?void 0:s.useVersion2,H=null===(_=e.attributes)||void 0===_?void 0:null===(v=_.marketingServicesDetails)||void 0===v?void 0:v.hasSuccessfulLeadDelivery,G={arrival:f,geo:P,insured:(null==e?void 0:null===(N=e.answers)||void 0===N?void 0:N.insured)||(null==e?void 0:null===(O=e.answers)||void 0===O?void 0:O.hasAutoInsurance),impressionPath:i,placement:K.lO.ExitPage,forceNoLeadSale:C||a||k&&!H||!!(null==e?void 0:null===(A=e.damascusConfig)||void 0===A?void 0:null===(S=A.global.codeTests)||void 0===S?void 0:S.forceNoLeadSale),leadUuid:e.leadUuid,campaignUuid:b,affiliationNormalized:U,affiliationUlid:y,session:e,brand:t?"marketing-services":"marketplace"};t&&ev({props:G,initSession:e,marketingServicesPartnerConfig:M,isPrefetchingAds:a});let V=r?er:eo,F=r?"EAP Request":"Assigned Matches Request";try{n.t.debug("Calling ".concat(F," (1)"),{answers:null==e?void 0:e.answers,arrivalId:f.uuid}),a&&await (0,el.q)(e);let i=await V(G);if(n.t.debug("".concat(F," result (1)"),{matchesLength:null==i?void 0:null===(p=i.AssignedMatchesList)||void 0===p?void 0:null===(I=p.AssignedMatches)||void 0===I?void 0:I.length,uuid:null==i?void 0:i.uuid,leadTimestamp:null==i?void 0:i.LeadTimestamp}),i)return null!==(T=null==i?void 0:i.AssignedMatchesList)&&void 0!==T?T:g;n.t.debug("Calling ".concat(F," (2)"),{answers:null==e?void 0:e.answers,arrivalId:f.uuid}),await (0,el.q)(e);let t=await V(G,!0);if(n.t.debug("".concat(F," result (2)"),{matchesLength:null==t?void 0:null===(L=t.AssignedMatchesList)||void 0===L?void 0:null===(R=L.AssignedMatches)||void 0===R?void 0:R.length,uuid:null==t?void 0:t.uuid,leadTimestamp:null==t?void 0:t.LeadTimestamp}),t)return null!==(m=null==t?void 0:t.AssignedMatchesList)&&void 0!==m?m:g}catch(e){n.t.error("Error getting ".concat(F,": ").concat(e),{error:e,arrivalId:f.uuid})}return g},eN=function(e){var i;let{session:t,isModernAdList:o,impressionPath:l,initRequest:u=!0,isPrefetchingAds:d=!1}=e,{setAttribute:s,setCache:c}=(0,ed.B)(e=>e),[E,v]=(0,r.useState)(),[_,N]=(0,r.useState)(),[O,S]=(0,r.useState)(),A=async e=>{if(!e)return;let i=[],r=[];await (0,a.Ay)(e,async e=>{if("quote_in_ad"===e.QuoteType){var a,n;let o=await eu(t,e,l);(null==o?void 0:null===(a=o.response_data)||void 0===a?void 0:a.quote)&&(i.push(e),r.push(null==o?void 0:null===(n=o.response_data)||void 0===n?void 0:n.quote))}else i.push(e),r.push(void 0)},{concurrency:5}),v(i),N(r)};return(0,r.useEffect)(()=>{(0,eE.q)(t)},[null===(i=t.attributes)||void 0===i?void 0:i.cache]),(0,r.useEffect)(()=>{(async()=>{if(u){var e,i,a,r,E,_,N,O,I,p,R,L,T,m;let u;let g=l===K.Do.POPUNDER?null===(i=t.attributes)||void 0===i?void 0:null===(e=i.cache)||void 0===e?void 0:e.popUnderMatches:null===(r=t.attributes)||void 0===r?void 0:null===(a=r.cache)||void 0===a?void 0:a.postFormMatches;(null==g?void 0:g.AssignedMatches)&&(null==g?void 0:null===(E=g.AssignedMatches)||void 0===E?void 0:E.length)>0?(n.t.info("Using cached matches",{arrivalId:t.arrival.uuid,impressionPath:l}),u=g):u=await e_(t,l,!!(null==t?void 0:null===(L=t.damascusConfig)||void 0===L?void 0:null===(R=L.global)||void 0===R?void 0:R.marketingServicesPartner),d,null==t?void 0:null===(m=t.damascusConfig)||void 0===m?void 0:null===(T=m.global)||void 0===T?void 0:T.useEAP),u&&(n.t.info("Caching matches",{arrivalId:t.arrival.uuid,impressionPath:l}),c(l===K.Do.POPUNDER?"popUnderMatches":"postFormMatches",u));let f=null==t?void 0:null===(N=t.damascusConfig)||void 0===N?void 0:null===(_=N.global)||void 0===_?void 0:_.marketingServicesPartner;!f||(null===(I=t.damascusConfig)||void 0===I?void 0:null===(O=I.global.marketingServices)||void 0===O?void 0:O.useVersion2)||await (0,ec.wT)({partnerName:f,session:t,setAttribute:s,matches:u,isPrefetchingAds:d}),v(null===(p=u.AssignedMatches)||void 0===p?void 0:p.filter(e=>"quote_in_ad"!==e.QuoteType)),S(null==u?void 0:u.PageViewPixel),o||A(u.AssignedMatches)}})()},[u]),{assignedMatches:E,quotedMatches:_,pageViewPixel:O}}}}]);